services:
  - type: web
    name: mindneox-backend
    env: python
    plan: free
    region: oregon
    # Ensure any legacy `pinecone-client` package is removed before install to
    # avoid the runtime exception where the new `pinecone` package refuses to
    # run when the old package is present. We also uninstall any stray
    # `pinecone` and then install a pinned `pinecone` release so that the
    # runtime environment is consistent.
    buildCommand: >-
      pip uninstall -y pinecone-client || true && \
      pip uninstall -y pinecone || true && \
      pip install --no-cache-dir "pinecone==7.3.0" && \
      pip install --no-cache-dir -r requirements.txt
    startCommand: uvicorn main:app --host 0.0.0.0 --port $PORT
    workingDirectory: .
    envVars:
      - key: MODEL_URL
        value: ""
      - key: CLERK_SECRET_KEY
        value: ""
      - key: REDIS_URL
        value: ""
      - key: ALLOWED_ORIGINS
        value: "https://your-frontend-url.vercel.app"
